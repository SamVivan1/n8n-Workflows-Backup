{"updatedAt":"2025-11-25T09:50:12.000Z","createdAt":"2025-11-08T03:20:00.410Z","id":"l0jFI8iMRjovFIVd","name":"TA","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"10e4c630-6bce-4038-8777-916fba8bdc28","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"2b5ed276-ef18-41bb-9ceb-869ea7b2a8ac","name":"Webhook","webhookId":"10e4c630-6bce-4038-8777-916fba8bdc28"},{"parameters":{"assignments":{"assignments":[{"id":"7e47a069-03a9-475b-b19f-c91eee92521e","name":"body","value":"={{ $json.body }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[112,-224],"id":"30cf0e73-5670-4235-9db7-f9583f824e99","name":"Edit Fields"},{"parameters":{"dataTableId":{"__rl":true,"value":"Djm3LVnFr6R3Ayw8","mode":"list","cachedResultName":"TA","cachedResultUrl":"/projects/DiQC0tGxFhuiK9UM/datatables/Djm3LVnFr6R3Ayw8"},"columns":{"mappingMode":"defineBelow","value":{"time":"={{ $json.body.timestamp }}","ip_source":"={{ $json.body.src_ip }}","protocol":"={{ $json.body.protocol }}","EventID":"={{ $json.body.eventid }}","SessionID":"={{ $json.body.session }}","Source":"={{ $json.body.message }}","Command":"={{ $json.body.input }}"},"matchingColumns":["logs"],"schema":[{"id":"time","displayName":"time","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Command","displayName":"Command","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"ip_source","displayName":"ip_source","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"protocol","displayName":"protocol","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"EventID","displayName":"EventID","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"SessionID","displayName":"SessionID","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Source","displayName":"Source","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[320,-224],"id":"d6ce084c-37e4-481f-8c91-47c9ece56282","name":"Insert row"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.body.type }}","rightValue":"attacker-session","operator":{"type":"string","operation":"equals"},"id":"5eee27fb-395e-4528-a930-dc591aa335de"}],"combinator":"and"},"renameOutput":true,"outputKey":"Attacker Session"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"69852c71-48a5-41c9-8622-41667f97cef1","leftValue":"={{ $json.body.type }}","rightValue":"attacker-behavior","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Attacker Behavior"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[208,0],"id":"58623537-576a-465d-ac2a-78a0479f0e2c","name":"Switch"},{"parameters":{"promptType":"define","text":"={{ $json.body }}","hasOutputParser":true,"options":{"systemMessage":"=# Attacker Session Analyzer - System Prompt\n\n## Role\nYou are the *Attacker Session Security Analyst AI*, tasked with analyzing attacker sessions captured by the Cowrie honeypot. Your job is to interpret attacker behavior, determine their intent, identify dangerous actions, and produce a structured threat assessment.\n\n## Input Format\nYou will receive JSON with structure:\n\n```\n{\n  \"type\": \"attacker-session\",\n  \"ip\": \"172.x.x.x\",\n  \"session_id\": \"string\",\n  \"start_time\": \"ISO timestamp\",\n  \"end_time\": \"ISO timestamp\",\n  \"command_count\": number,\n  \"commands\": [\n      {\n        \"timestamp\": \"...\",\n        \"eventid\": \"cowrie.command.input\",\n        \"input\": \"string\",\n        ...\n      }\n  ]\n}\n```\n\n## Objectives\n1. **Analyze attacker intent**  \n   Example categories:\n   - reconnaissance  \n   - destructive actions  \n   - privilege escalation  \n   - persistence  \n   - malware installation  \n   - exfiltration  \n   - command probing / trial & error  \n   - automated scanner behavior\n\n2. **Describe attacker behavior clearly**, including:\n   - what they tried to do  \n   - why they executed certain commands  \n   - whether the sequence suggests manual or automated actions\n\n3. **Identify dangerous commands**, for example:\n   - `rm -rf /` or `rm -rf boot` â†’ destructive  \n   - `wget` / `curl` external links â†’ potential malware download  \n   - `chmod +x` â†’ preparing executable  \n   - `useradd`, `passwd` â†’ persistence  \n   - `uname -a`, `ls`, `cat /etc/*` â†’ reconnaissance\n\n4. **Assess threat level**, using this scale:\n\n### Threat Levels\n| Level | Description |\n|-------|-------------|\n| **Informational** | Harmless inspection like `ls`, `pwd`, simple exploration |\n| **Low** | Reconnaissance without dangerous actions |\n| **Medium** | Suspicious patterns, directory probing, partial system manipulation |\n| **High** | Dangerous commands, attempts to modify system state, download files |\n| **Critical** | Active destruction, malware deployment, privilege escalation, persistence creation |\n\n5. **Produce human-readable reasoning**, not only listing logs.\n\n6. **Produce a final structured JSON output.**\n\n## Output Format\nYou must reply using **this exact structured JSON**:\n\n```\n{\n  \"session_summary\": \"Narrative explanation of what attacker attempted to do.\",\n\n  \"attacker_intent\": \"One of: reconnaissance | destructive | malware installation | persistence | privilege escalation | exfiltration | mixed | unknown\",\n\n  \"suspicious_commands\": [\n      {\"cmd\": \"rm -rf /\", \"reason\": \"Destructive filesystem wipe\"},\n      {\"cmd\": \"wget http://malicious\", \"reason\": \"Possible malware download\"}\n  ],\n\n  \"behavior_analysis\": \"Explain whether attacker looks skilled, automated, random, or targeted.\",\n\n  \"threat_level\": \"Informational | Low | Medium | High | Critical\",\n\n  \"timeline\": [\n      {\"timestamp\": \"...\", \"action\": \"Attacker logged in\"},\n      {\"timestamp\": \"...\", \"action\": \"Executed ls\"},\n      {\"timestamp\": \"...\", \"action\": \"Executed rm -rf /\"}\n  ],\n\n  \"recommendations\": [\n      \"Block IP address\",\n      \"Analyze downloaded artifacts if any\",\n      \"Add stricter SSH rate limits\",\n      \"Apply additional honeypot deception techniques\"\n  ]\n}\n```\n\n## Additional Notes\n- Provide deep analysis, not surface-level summary.\n- Evaluate intent even if commands fail (because Cowrie is a honeypot).\n- Be precise with threat classification."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[656,-272],"id":"9ece094d-6a26-4760-b459-f0320b956c4e","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[528,-64],"id":"2e729636-175a-4346-9626-5c32bf22ba3a","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"LPqCX4YBuBetFhd2","name":"Google Gemini(PaLM) Api bintang10panji@gmail.com"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.body.session_id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[688,-64],"id":"92abc882-0a64-4b09-a408-fdca65ac6285","name":"Simple Memory"},{"parameters":{"authentication":"webhook","content":"={{ $json.content }}","options":{}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[1280,-32],"id":"67f07e2f-53bf-4add-954d-e545093f6ad8","name":"Discord","webhookId":"95cf9361-7088-4450-98b7-440e2b69a15d","credentials":{"discordWebhookApi":{"id":"3MQKCQrGiORnhds6","name":"HomeLab n8nbot"}}},{"parameters":{"jsonSchemaExample":"{\n  \"session_id\": \"string\",\n  \"ip\": \"string\",\n  \"start_time\": \"HH:MM:SS\",\n  \"end_time\": \"HH:MM:SS\",\n\n  \"session_summary\": \"string\",\n\n  \"attacker_intent\": \"string\",\n\n  \"suspicious_commands\": [\n      {\"cmd\": \"string\", \"reason\": \"string\"}\n  ],\n\n  \"behavior_analysis\": \"string\",\n\n  \"threat_level\": \"Informational | Low | Medium | High | Critical\",\n\n  \"timeline\": [\n      {\"time\": \"HH:MM:SS\", \"action\": \"string\"}\n  ],\n\n  \"recommendations\": [\"string\", \"string\"]\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[832,-64],"id":"7e8e9704-a35f-4b98-a435-d774dd0101ae","name":"Structured Output Parser"},{"parameters":{"jsCode":"const data = $input.first().json.output;\n\n// Safeguard\nconst safe = v => (v === undefined || v === null ? \"unknown\" : v);\n\n// Format time to HH:MM:SS\nconst fixTime = (t) => {\n  if (!t) return \"unknown\";\n  if (t.length === 8) return t;\n  const d = new Date(t);\n  if (isNaN(d)) return t;\n  return d.toISOString().substring(11,19);\n};\n\n// List formatter\nconst list = (arr, fmt) => {\n  if (!arr || arr.length === 0) return \"(none)\";\n  return arr.map(fmt).join(\"\\n\");\n};\n\n// Build final report text (NO EMBED)\nlet message =\n`ðŸš¨ **Honeypot Attacker Session Report**\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n**ðŸ†” Session ID:** \\`${safe(data.session_id)}\\`\n**ðŸŒ IP:** \\`${safe(data.ip)}\\`\n**â³ Duration:** ${fixTime(data.start_time)} âž ${fixTime(data.end_time)}\n**ðŸ’¥ Threat Level:** ${safe(data.threat_level)}\n\n### ðŸ“ Session Summary\n${safe(data.session_summary)}\n\n### ðŸŽ¯ Attacker Intent\n**${safe(data.attacker_intent)}**\n\n### âš ï¸ Suspicious Commands\n${list(data.suspicious_commands, (c, i) => `**${i+1}.** \\`${c.cmd}\\` â€” ${c.reason}`)}\n\n### ðŸ‘€ Behavior Analysis\n${safe(data.behavior_analysis)}\n\n### ðŸ•’ Timeline\n${list(data.timeline, (t, i) => `**${i+1}.** \\`${fixTime(t.time)}\\`\\nâž¡ï¸ ${t.action}`)}\n\n### ðŸ›¡ï¸ Recommendations\n${list(data.recommendations, (r, i) => `**${i+1}.** ${r}`)}`;\n\n\n// ========== DISCORD HARD LIMIT FIX ==========\nconst MAX = 1800;\nlet chunks = [];\n\nwhile (message.length > MAX) {\n  chunks.push(message.slice(0, MAX));\n  message = message.slice(MAX);\n}\nchunks.push(message);\n\nreturn chunks.map(c => ({\n  json: { content: c }\n}));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1008,-272],"id":"cb8d9200-2ef9-4ddf-86d5-aacaa89af218","name":"Code in JavaScript"},{"parameters":{"promptType":"define","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[624,144],"id":"2c39fddd-6dda-461d-832b-afe91473756f","name":"AI Agent1"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[496,352],"id":"9f499955-845a-4f94-a617-b1a6db9e8b6e","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"LPqCX4YBuBetFhd2","name":"Google Gemini(PaLM) Api bintang10panji@gmail.com"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[640,352],"id":"11b78f07-669c-4919-8624-b0d8cffc872f","name":"Simple Memory1"}],"connections":{"Webhook":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Insert row","type":"main","index":0}]]},"Switch":{"main":[[{"node":"AI Agent","type":"main","index":0}],[]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Discord","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Discord","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"AI Agent1","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"errorWorkflow":"AvhjGJdACMdnvIEn"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.samvivan.my.id","user-agent":"python-requests/2.31.0","content-length":"3476","accept":"*/*","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"182.10.225.121","cf-ipcountry":"ID","cf-ray":"9a401b386e02cdfd-SIN","cf-visitor":"{\"scheme\":\"https\"}","cf-warp-tag-id":"6925438f-1f6d-42c2-bd8c-067f9f173b2a","connection":"keep-alive","content-type":"application/json","x-forwarded-for":"182.10.225.121","x-forwarded-proto":"https"},"params":{},"query":{},"body":{"type":"attacker-session","ip":"172.22.0.1","session_id":"89174a78a901","start_time":"2025-11-25T09:24:31.134610Z","end_time":"2025-11-25T09:26:45.251131Z","command_count":12,"commands":[{"eventid":"cowrie.command.input","input":"ls","message":"CMD: ls","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:34.223897Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"cd /","message":"CMD: cd /","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:36.525502Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"ls","message":"CMD: ls","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:37.270367Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"rm /boot -rf","message":"CMD: rm /boot -rf","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:43.972506Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"ls","message":"CMD: ls","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:44.934405Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"cd srv/","message":"CMD: cd srv/","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:48.449273Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"l","message":"CMD: l","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:48.758369Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.failed","input":"l","message":"Command not found: l","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:48.758847Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"ls","message":"CMD: ls","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:24:49.568482Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"wget https://secure.eicar.org/eicar.com.txt","message":"CMD: wget https://secure.eicar.org/eicar.com.txt","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:26:40.534332Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"ls","message":"CMD: ls","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:26:43.338072Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"},{"eventid":"cowrie.command.input","input":"exit","message":"CMD: exit","sensor":"f1f579776b5c","uuid":"dafa3092-c780-11f0-901d-c2c7fa469b2b","timestamp":"2025-11-25T09:26:45.205986Z","src_ip":"172.22.0.1","session":"89174a78a901","protocol":"ssh"}],"additional_kwargs":{},"response_metadata":{}},"webhookUrl":"https://n8n.samvivan.my.id/webhook/10e4c630-6bce-4038-8777-916fba8bdc28","executionMode":"production"}}],"AI Agent":[{"json":{"output":{"session_id":"89174a78a901","ip":"172.22.0.1","start_time":"2025-11-25T09:24:31.134610Z","end_time":"2025-11-25T09:26:45.251131Z","session_summary":"The attacker initiated the session with basic reconnaissance, using `ls` to explore directories. They then navigated to the root directory and attempted a highly destructive action by executing `rm /boot -rf`, aiming to delete critical system boot files. Following this, they explored the `/srv` directory and subsequently tried to download a file from an external URL (`https://secure.eicar.org/eicar.com.txt`) using `wget`, which indicates an attempt to introduce external content, potentially malware. The session concluded with an `exit` command.","attacker_intent":"mixed","suspicious_commands":[{"cmd":"rm /boot -rf","reason":"Destructive filesystem wipe attempt targeting critical boot files."},{"cmd":"wget https://secure.eicar.org/eicar.com.txt","reason":"Attempt to download an external file, indicative of potential malware installation or payload delivery."}],"behavior_analysis":"The attacker's behavior suggests a manual operator rather than an automated script. This is supported by the varied command sequence, including initial reconnaissance, a clear attempt at system destruction, and a subsequent attempt to download an external file. The presence of a typo (`l` instead of `ls`) further confirms manual interaction and an adaptive approach during the session.","threat_level":"Critical","timeline":[{"time":"2025-11-25T09:24:34.223897Z","action":"Attacker logged in and executed `ls` for initial directory reconnaissance."},{"time":"2025-11-25T09:24:36.525502Z","action":"Navigated to the root directory (`cd /`)."},{"time":"2025-11-25T09:24:37.270367Z","action":"Executed `ls` to list contents of the root directory."},{"time":"2025-11-25T09:24:43.972506Z","action":"Attempted a critical destructive action by executing `rm /boot -rf`."},{"time":"2025-11-25T09:24:44.934405Z","action":"Executed `ls` after the destructive command, possibly to verify its effect."},{"time":"2025-11-25T09:24:48.449273Z","action":"Navigated into the `/srv` directory (`cd srv/`)."},{"time":"2025-11-25T09:24:48.758369Z","action":"Executed `l`, a failed command likely a typo for `ls`."},{"time":"2025-11-25T09:24:49.568482Z","action":"Executed `ls` to list contents of the `/srv` directory."},{"time":"2025-11-25T09:26:40.534332Z","action":"Attempted to download a file from an external URL using `wget https://secure.eicar.org/eicar.com.txt`."},{"time":"2025-11-25T09:26:43.338072Z","action":"Executed `ls` to check for the downloaded file."},{"time":"2025-11-25T09:26:45.205986Z","action":"Terminated the session by executing `exit`."}],"recommendations":["Block the attacker's IP address (172.22.0.1) immediately.","Investigate for similar destructive or file download patterns from other IPs.","Strengthen system access controls and implement robust intrusion detection and prevention systems.","Analyze the intended payload (even if EICAR test file, the method is critical) to understand attacker's chosen tools and targets.","Deploy additional honeypot deception techniques to gather more intelligence on manual, destructive attackers."]}}}]},"versionId":"fafc2a45-9306-4b98-ba67-3bfc260fe509","triggerCount":1,"shared":[{"updatedAt":"2025-11-08T03:20:00.415Z","createdAt":"2025-11-08T03:20:00.415Z","role":"workflow:owner","workflowId":"l0jFI8iMRjovFIVd","projectId":"DiQC0tGxFhuiK9UM"}],"tags":[]}